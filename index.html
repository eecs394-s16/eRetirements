<html>
<head>
  <title>Home</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  <link href='https://fonts.googleapis.com/css?family=Hind:400,300' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="styles.css">

  <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script src="./questionScript.js" type="text/javascript"></script>
  <!--<link rel="stylesheet" href="/resources/demos/style.css">-->
  
  <script>
  var total_completed = 0;
  var modal;
  var openModal;
  var star_num = 0;
  
  var lightgreenRGB = "rgb(144, 238, 144)";
  var current = 1;
  var category;
  var completed_num = 0;


  var community_2nd_completed = false;


  // console.log("start: completed_num :" + completed_num);
  var clickItem;
   
  $(document).ready(function() {

    $(".category").hover(function() {
      $(this).css('border-color', '#6C9B74'); //teal/blue
    }, function () {
      if (category_num_completed[this.id] > 0){
        $(this).css('border-color', lightgreenRGB); //lightgreen
      } else {
        $(this).css('border-color', '#EBEBEB'); //gray
      }
      
    });

    $(document).on('click','.progressdiv',function(event){





      var id = event.target.id;
      var index = parseInt(id.substring(11));
      current = index;
      var current_v = index-1
      console.log("current:::::" + current)
      var questionAndAnswers = categories[category];
      var total = questionAndAnswers.length;
      var currentQuestionAndAnswers = questionAndAnswers[index-1];
      $('#question_number').text( "Question " + index +" out of " + total);
      $('#question_content').text(currentQuestionAndAnswers["question"]);

      var answers = currentQuestionAndAnswers["answers"];
      var len = answers.length;
      var str = "";
      console.log();
      for(var i = 0; i < len; i++)
      {
        var j = i+1;
        var styles = "style='border-radius:10px; text-align:center;";
        if(categories[category][current_v]["results"][i]){
            styles += " background-color:lightgreen;";
            document.getElementById("next").disabled = false;
        }
        styles+="'";
        str += "<li><button id='button"+j+"' class='list-group-item answer'"+styles+" onclick='focusButton("+j+","+len+","+(current_v)+")'>  " + answers[i] +
        "</button></li>";

      }
      $('#question_option').html(str);
    });

    $('.Quiz').hide();
    // var $completed = $('completed');

    $('.category').click(function(e) {
      var $clickedItem = $(e.target);
      var idName = jQuery(this).attr("id");
      showQuestion(idName);

    });
      
          openModal = document.getElementById('openModal');
      
       $(window).load(function(){
           openModal.style.display = "block";
    });


    // Get the modal
    modal = document.getElementById('myModal');

      allModal = document.getElementsByClassName('modal');

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[1];
      var oSpan = document.getElementsByClassName("close")[0];
//      var oSpan = document.getElementsByClassName("oClose")[0];

    // When the user clicks on <span> (x), close the modal
    span.onclick = function(event) {
        modal.style.display = "none";
    }
    
    oSpan.onclick = function(event) {
    openModal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
      if (event.target == allModal) {
        allModal.style.display = "none";
      }
    }
    

  });
      
   var removeOpenModal = function() {
        $(openModal).remove();
       console.log("hello");
    }

  var showQuestion = function(idName){
    $('.row').css("opacity","0.5");
    $('.Quiz').show();
    $("#submitRating").hide();
    $("#prev").show();
    $("#next").show();
    $("#skip").show();
    $("#finish").show();
    
    $("#progress").show();
    category = idName;
    current = 1;

    completed_num = category_num_completed[category]; //num_completed
    var questionAndAnswers = categories[category];
    var total = questionAndAnswers.length;

    if (completed_num > 0){
      for(var k = 0; k < total; k++){
        debugger;
        if (String(questionAndAnswers[k]["results"]) == String([false, false, false, false])){
          current = k+1;
          break;
        }
      }
    }


    // console.log("current:"+current);
    
    changeQuestion(category);
    
    

    if (completed_num > 0){
      for(var k = 0; k < total; k++){
        debugger;
        if (String(questionAndAnswers[k]["results"]) == String([false, false, false, false])){
          current = k;
          break;
        }
      }
      current = 1;
    }
    else {
      current = 1;
    }

    


    var strb ="";
    for(var i=0; i<total; i++)
    {
      var j =i+1;
      var styles = "";
      if (categories[category][i]["results"].indexOf(true) > -1) 
      {
        styles = "style='background-color:lightgreen'";
      }

      strb += "<div id='progressdiv"+j+"' class='progressdiv'"+styles+">Q"+j+"</div>";
    }

    $('#progress').html(strb);
  }

  var changeQuestionPrev = function() {
    current -= 1;
    var questionAndAnswers = categories[category];
    var total = questionAndAnswers.length;
    if(current < 1)
    {
      $('.Quiz').hide();
      $('.row').css("opacity","1");
    }
    else
    {
      console.log("here");
      changeQuestion(category);
    }

  }
  var changeQuestionSkip = function(){
    var str = "#progressdiv"+(current);
    if ($(str).css('background-color') != lightgreenRGB){
      $(str).css({'background-color': 'yellow'});
    }
    
    current += 1;
    var questionAndAnswers = categories[category];
    var total = questionAndAnswers.length;

    percent = (1-completed_num/total) * 100;
    if(current > total){
        showRating();
    }
    else
    {
      changeQuestion(category);
    }
  }

  var changeQuestionNext = function(){
    current += 1;
    if (total_completed == 10) {
      var tooltips = $( "[title]" ).tooltip({
          position: {
            my: "left top",
            at: "right+5 top-100"
          }
        });
      tooltips.tooltip( "open" );
      modal.style.display = "block";
      document.getElementById('results').disabled = false;

      
    }
    var questionAndAnswers = categories[category];
    var total = questionAndAnswers.length;
    if(current > total){
        showRating();
    }
    else{
      changeQuestion(category);
    }
    
  }
  var changeQuestion = function(category){

    var questionAndAnswers = categories[category];
    var title;
    if (category == "location"){
      title = "Location & Weather"
    } else if (category == "community"){
      title = "Community & Demographics"
    } else if (category == "activities") {
      title = "Activities & Work Potential"
    } else if (category == "health") {
      title = "Health Care"
    } else if (category == "costs") {
      title = "Cost of Living"
    } 
    document.getElementById("category_title").innerHTML = title;
    var total = questionAndAnswers.length;
    var currentQuestionAndAnswers = questionAndAnswers[current-1];
    $('#question_number').text( "Question " + current +" out of " + total);
    $('#question_content').text(currentQuestionAndAnswers["question"]+"");

    var answers = currentQuestionAndAnswers["answers"];
    var len = answers.length;
    var str = "";
    console.log();
    document.getElementById("next").disabled = true;
    for(var i = 0; i < len; i++)
    {
      var j = i+1;
      var styles = "style='border-radius:10px; text-align:center;";
      if(categories[category][current-1]["results"][i]){
        styles += " background-color:lightgreen;";
        document.getElementById("next").disabled = false;
      }
      styles+="'";
      str += "<li><button id='button"+j+"' class='list-group-item answer'"+styles+" onclick='focusButton("+j+","+len+","+(current-1)+")'>  " + answers[i] +
      "</button></li>";

    }
    $('#question_option').html(str);



  }
  var showRating = function(){

    document.getElementById("submitRating").disabled = true;

    var questionAndAnswers = categories[category];
    var title;
    if (category == "location"){
      title = "Location & Weather"
    } else if (category == "community"){
      title = "Community & Demographics"
    } else if (category == "activities") {
      title = "Activities & Work Potential"
    } else if (category == "health") {
      title = "Health Care"
    } else if (category == "costs") {
      title = "Cost of Living"
    } 
    document.getElementById("category_title").innerHTML = title;
    
    
    var str = "";
    //four stars
    for (var s = 0; s < 4; s++){
      // str += "<span class='star' onclick='rate()'>&#9733</span>";
      str += "<span class='star'>&#9733</span>";
    }


    $('#question_option').html(str);
    
    $(".star").click(function(e){
      rate(e);
    });

    var stars = $('#question_option').children();

    if (ratings[category] > 0) {
      document.getElementById("submitRating").disabled = false;
    }

    for (var r = 0; r < ratings[category]; r++){
      stars[r].style.color = "orange";
    }


    str = "Please rank how important this category is to you."
    $('#question_content').html(str);
    str = ""
    $('#question_number').html(str);
    $("#prev").hide();
    $("#next").hide();
    $("#skip").hide();
    $("#finish").hide();
    $("#submitRating").show();
    $("#progress").hide();


  }
  
  
  var rate = function(e) {
      // $('.star').click(function(e) {

        document.getElementById("submitRating").disabled = false;

        var $clickedItem = $(e.target);

        $clickedItem.css({'color':'orange'});
        star_num = $clickedItem.index() + 1;
        $clickedItem.prevAll().css({'color':'orange'});
        $clickedItem.nextAll().css({'color':'lightgray'});

  }
  
 var submitRate = function() {
  if (category == "location"){
        ratings["location"] = star_num;
      } else if (category == "community"){
        ratings["community"] = star_num;
      } else if (category == "activities") {
        ratings["activities"] = star_num;
      } else if (category == "health") {
        ratings["health"] = star_num;
      } else if (category == "costs") {
        ratings["costs"] = star_num;
      }

    // else if(current > total + 1)
    var questionAndAnswers = categories[category];
    var total = questionAndAnswers.length;
    console.log("completed:" + completed_num);
    if(completed_num == total)
    {
      // console.log("completed:" + completed);
      $("#" +category).find(".completed").css({'visibility': 'visible'});
    }
    percent = (1-completed_num/total) * 100;
    console.log("percent:" +percent);

    console.log("Percent =" + percent);

    // $("#" +category).css({'background-color': '#DCFDE1', 'border-color': '#DCFDE1'});
    $("#" +category).css({'background-image':
    'linear-gradient(to bottom, transparent '+ percent +'%, #90EE90 0)'});
    $("#" +category + " h3").html(completed_num +"/"+total);

    if (percent < 100){
      $("#" +category).css('border-color', '#90EE90');
    }
    else {
      $("#" +category).css('border-color', '#EBEBEB');
    }


    $('.Quiz').hide();
    $('.row').css("opacity","1");
    
 }

  var focusButton = function(buttonIndex,len,questionIndex){
    if (categories[category][questionIndex]["results"].indexOf(true) == -1) 
    {
        completed_num+=1;
    }
    category_num_completed[category] = completed_num;
    
    var progressdivSelector = "#progressdiv"+(questionIndex+1);
    var buttonSelector = "#button"+buttonIndex;
    if (category == "community" && questionIndex == 2){
      if (community_2nd_completed == false) {
        total_completed+=1;
      }
      community_2nd_completed = true;
      if ($(buttonSelector).css("background-color") == lightgreenRGB){
        $(buttonSelector).css({'background-color': 'white'});
      }
      else {
        $(buttonSelector).css({'background-color': 'lightgreen'});
      }
      var areAnyGreen = false
      for (var i=1;i<=len;i++){
        if ($("#button"+i).css("background-color") == lightgreenRGB){
          areAnyGreen = true;
          break;
        }
      }
      if (areAnyGreen){
        $(progressdivSelector).css({'background-color': 'lightgreen'});
      }
      else {
        $(progressdivSelector).css({'background-color': 'white'});
      }
      categories[category][questionIndex]["results"][buttonIndex-1] = !categories[category][questionIndex]["results"][buttonIndex-1];//1-4
    }
    else {
      total_completed += 1;
      for (var i=1; i<=len; i++)
      {
        $("#button"+i).css({'background-color': 'white'});
      }
      $(buttonSelector).css({'background-color': 'lightgreen'});
      $(progressdivSelector).css({'background-color': 'lightgreen'});
      categories[category][questionIndex]["results"] = [false,false,false,false];//1-4
      categories[category][questionIndex]["results"][buttonIndex-1] = true;//1-4
    }
    document.getElementById("next").disabled = false;
  }
  </script>

</head>
<body>
    <div id="openModal" class="modal">

      <!-- Modal content -->
      <div class="modal-content">
        <span class="close">x</span>
        <center>
          <h2 style="font-weight:bold">Welcome to eRetirements!</h2>
            <p style="font-size:20px">Our free questionnaire will help us learn about your interests and preferences. After that we'll tell you what area we think would be a perfect fit for you.</p>
            <p style="font-size:20px">You only need to fill out 10 questions, but the more you answer, the more accurate your result.</p>
            <button class="btn btn-success btn-lg" onclick="removeOpenModal();">Let's get started!</button>

        </center>
      </div>

    </div>
    
  <center>
    <div id="question" class="Quiz">
      <div id="category_title">
        Location Quiz
      </div>
      <div id="question_area">
        <p id="question_number">
        </p>

        <br>
        <p id="question_content">
        </p>
        <ul class="list-group" id="question_option">
        </ul>

      </div>
      <div id="progress"></div>
      <div id="button_area">


        <button id="prev" onclick="changeQuestionPrev()" class="btn">prev</button>
        <button id="skip" onclick="changeQuestionSkip()" class="btn">skip</button>
        <button id="finish" onclick="showRating()" class="btn btn-success" >finish</button>
        <button id="next" onclick="changeQuestionNext()" class="btn btn-success" disabled>next</button>
         <button id="submitRating" onclick="submitRate()" class="btn btn-success" disabled>Submit Rating</button>


      </div>

    </div>
      
      <!--        Rating-->
      
<!--
          <div id="question" class="Quiz">
      <div id="category_title">
        Location Quiz
      </div>
      <div id="question_area">
        <p id="question_number">
        </p>

        <br>
        <p id="question_content">
        </p>
        <ul class="list-group" id="question_option">
        </ul>

      </div>
      <div id="progress"></div>
      <div id="button_area">


        <button id="prev" onclick="changeQuestionPrev()" class="btn">prev</button>
        <button id="skip" onclick="changeQuestionSkip()" class="btn">skip</button>
        <button id="next" onclick="changeQuestionNext()" class="btn btn-success" disabled>next</button>


      </div>

    </div>
-->

    <img src="navbar.png" alt="navbar" width=100%>
    <div class="row">
      <div id="location" class="category" >
        <br>
        <h2 id="titlename">Location &amp; Weather</h2>
        <h3 id="percentage">0/3</h3>
        <h1><i class="fa fa-sun-o" aria-hidden="true"></i></h1>
        <div class="completed">
          <p><i class="fa fa-check fa-4x" aria-hidden="true"></i></p>
        </div>
      </div>

      <div id="community" class="category">
        <br>
        <h2 id="titlename">Community &amp; Demographics</h2>
        <h3 id="percentage">0/5</h3>
        <h1><i class="fa fa-users" aria-hidden="true"></i></h1>
        <div class="completed">
          <p><i class="fa fa-check fa-4x" aria-hidden="true"></i></p>
        </div>
      </div>
      <div id="activities" class="category">
        <br>
        <h2 id="titlename">Activities &amp; Work Potential</h2>
        <h3 id="percentage">0/4</h3>
        <h1><i class="fa fa-bicycle" aria-hidden="true"></i></h1>
        <div class="completed">
          <p><i class="fa fa-check fa-4x" aria-hidden="true"></i></p>
        </div>
      </div>
    </div>
    <div class="row">
      <div id="health" class="category">
        <br><h2 id="titlename">Health Care</h2>
        <h3 id="percentage">0/3</h3>
        <h1><i class="fa fa-medkit" aria-hidden="true"></i></h1>
        <div class="completed">
          <p><i class="fa fa-check fa-4x" aria-hidden="true"></i></p>
        </div>
      </div>
      <div id="costs" class="category">
        <br>
        <h2 id="titlename">Cost of Living</h2>
        <h3 id="percentage">0/3</h3>
        <h1><i class="fa fa-usd" aria-hidden="true"></i></h1>
        <div class="completed">
          <p><i class="fa fa-check fa-4x" aria-hidden="true"></i></p>
        </div>
      </div>

    </div>

  </center>
  
    <p title = "you can click the results button below at any time to see your results"></p> 

  <a href="results.html"><button class="btn btn-lg btn-primary" disabled id="results">Results
    <i class="fa fa-arrow-right" aria-hidden="true"></i></button></a>
    


    <div id="myModal" class="modal">

      <div class="modal-content">
        <span class="close">x</span>
        <p>We think we have an idea of what you might be looking for.  If you want more accurate results, you can answer more questions.</p> <p>Would you like to continue the questionnaire?</p>
        <center>
          <button class="btn btn-success" onclick="modal.style.display = 'none'";>Yes, I'd like to get more accurate results.</button>
          <a href="results.html"><button class="btn btn-info">No, show me my results now.</button></a>
        </center>
      </div>

    </div>


  </body>





  </html>
